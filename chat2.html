<script>
        const chatForm = document.getElementById('chat-form');
        const chatContainer = document.getElementById('chat-container');
        const progress = document.getElementById('progress');

        function addMsg(sender, text) {
            const div = document.createElement('div');
            div.className = "message-fade mb-2";
            div.innerHTML = `<span class="opacity-40">[${sender}]:</span> <span class="${sender==='AI'?'text-emerald-300':''}">${text}</span>`;
            chatContainer.appendChild(div);
            chatContainer.scrollTop = chatContainer.scrollHeight;
        }

        chatForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            const val = document.getElementById('user-input').value;
            if(!val) return;

            document.getElementById('user-input').value = '';
            addMsg('USER', val);
            
            progress.style.width = '100%';

            try {
                const res = await fetch("/api/chat", {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({ prompt: val })
                });

                const data = await res.json();
                console.log("Resposta da API:", data); // Isso ajuda a ver o que está voltando

                if (res.ok) {
                    // O campo aqui deve bater com o que seu chat.js envia (data.resposta)
                    addMsg('AI', data.resposta || "Sem resposta definida.");
                } else {
                    addMsg('SYS', 'ERROR: ' + (data.error || 'Falha na API'));
                }
            } catch (err) {
                console.error("Erro no Fetch:", err);
                addMsg('SYS', 'CRITICAL: Connection Error');
            } finally {
                progress.style.width = '0%';
            }
        }); // <--- ESTA CHAVE E PARÊNTESE FALTAVAM

        window.onload = () => addMsg('SYS', 'Terminal Ready. Awaiting commands...');
    </script>
